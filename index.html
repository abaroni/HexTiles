<!DOCTYPE html>
<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <style>
  :root {
    --GESSO: #D7D4CD;
    --CANAPA: #C8C5BF;
    --CACAO: #79716F;
    --CENERE: #C6C6C6;
    --LAVAGNA: #7F8386;
  }

    .container{
     user-select: none;
      margin-top: 50px;
      color: #6C6;
    }
    .hexagon {
      font-size: 135px;
      margin: 0px;
      padding: 0px;
    }
    .honeycomb {
      margin: 0px;
      margin-top: -88px;
      letter-spacing: -21px;
    }

    .honeycomb2 {
      margin-top: -115px;
      margin-left: 51px;
      letter-spacing: -21px;
    }

    .honeycomb3 {
      margin-top: -115px;
      letter-spacing: -21px;
    }
  </style>
  <script>
  const GESSO = "var(--GESSO)"
  const CANAPA = "var(--CANAPA)"
  const CACAO = "var(--CACAO)"
  const CENERE = "var(--CENERE)"
  const LAVAGNA = "var(--LAVAGNA)"
  const COLORS = [GESSO,CANAPA,CACAO,CENERE,LAVAGNA]


  function setIdentifiers() {

    let rowNumber = 0
    $(".hexagon").each(function() {
      const text = $(this).text();
      $(this).text("")
      //creating unique span with ids
      for (var i = 0; i < text.length; i++) {
        const character = text.charAt(i)

        const currentId = "tile-"+rowNumber+"-"+i

        const element= $("<span></span>")
                        .text(character)
                        .attr("id",currentId)
                        .attr("data-color",COLORS[0])
                        .addClass("tile")

        $(this).append(element)

      }
      rowNumber++
    })
    colorize()
  }

  const getTile = function(row,column) {
    return $("#tile-"+row+"-"+column)
  }
  const getCoordinates = function(elem){
    //getCoordinates is horribly linked to "tile" length
    const array = elem.attr('id').substring(5).split("-")
    const row = parseInt(array[0])
    const column = parseInt(array[1])
    return [row,column]
  }

  const randomColor = function(){
    return randomColorFromSet(COLORS)
  }
  const randomColorFromSet = function(set){
    if (set.length == 0){
      console.error("randomColorFromSet for empty set - setting random color")
      return randomColor()
    }
    return set[Math.floor(Math.random()*set.length)]
  }

  const arrayDiff = (A,B) => A.filter(function(x) { return B.indexOf(x) < 0 })

  function getNeighborsElement(element){
    const row = getCoordinates(element)[0]
    const column = getCoordinates(element)[1]
    return getNeighbors(row,column)
  }
  function getNeighbors(row,column){
    const neighbors = []
    const root = getTile(row,column)
    if (root.length){
      neighbors.push( getTile(row,column-1) )
      neighbors.push( getTile(row,column+1) )
      if(row % 2){
        // odd row number
        //
        neighbors.push( getTile(row-1,column) )
        neighbors.push( getTile(row-1,column+1) )
        neighbors.push( getTile(row+1,column) )
        neighbors.push( getTile(row+1,column+1) )
      }else{
        // even row number
        //
        neighbors.push( getTile(row-1,column) )
        neighbors.push( getTile(row-1,column-1) )
        neighbors.push( getTile(row+1,column) )
        neighbors.push( getTile(row+1,column-1) )

      }
    }
    //avoid returnin not existing element
    return neighbors.filter (elem => elem.length)
  }

  function getColors(set){
    let colors = []
    set.forEach( function(e){
      const thisColor = e.attr('data-color')
      if($.inArray(thisColor, colors) === -1)
        colors.push(thisColor)
    })
    return colors
  }
  
  function colorize(){

      $(".tile").each(function() {
        const currentElement = $(this)
        const neighbors = getNeighborsElement(currentElement)
        const noGoodColors = getColors(neighbors)
        const possibleColors = arrayDiff(COLORS,noGoodColors)

        const actualColor = randomColorFromSet(possibleColors)
        $(this).attr('data-color',actualColor)
        $(this).css('color',actualColor)

      })

  }
  function rethink(){
    colorize()
  }
  </script>
</head>
<body onload="setIdentifiers()" onclick="rethink()">
  <div class="container">
    <div class="honeycomb">
      <span class="hexagon">&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;</span>
    </div>
    <div class="honeycomb2">
      <span class="hexagon">&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;</span>
    </div>
    <div class="honeycomb3">
      <span class="hexagon">&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;</span>
    </div>
    <div class="honeycomb2">
      <span class="hexagon">&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;</span>
    </div>
    <div class="honeycomb3">
      <span class="hexagon">&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;</span>
    </div>
    <div class="honeycomb2">
      <span class="hexagon">&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;</span>
    </div>
    <div class="honeycomb3">
      <span class="hexagon">&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;&#x2B22;</span>
    </div>
  <div>
</body>
</html>
