<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <style>
    .controls{
      padding-top: 20px;
      padding-bottom: 50px;
      margin-left: 36px;
    }

    * {
      -webkit-touch-callout: none; /* iOS Safari */
      -webkit-user-select: none; /* Safari */
      -khtml-user-select: none; /* Konqueror HTML */
      -moz-user-select: none; /* Firefox */
      -ms-user-select: none; /* Internet Explorer/Edge */
      user-select: none; /* Non-prefixed version, currently supported by Chrome and Opera */
    }
    :root {
      --GESSO: #D7D4CD;
      --CANAPA: #C8C5BF;
      --CACAO: #79716F;
      --CENERE: #C6C6C6;
      --LAVAGNA: #7F8386;
    }
    .modal-body{
      padding-top: 40px;
    }
    .modal-body .hexrow>span {
        display: grid;
        grid-template-columns: 10px 85px 85px 85px 85px 85px;
        height: 85px;
        line-height: 65px;
    }
    .modal-body .hexrowEven>span {
        display: grid;
        grid-template-columns: 50px 85px 85px 85px 85px 85px;
        height: 85px;
        line-height: 65px;
    }
    .modal-body .hexrow {
        margin-top: 0px;
    }
    .modal-body .hexrowEven {
        margin-left: 0px;
    }
    .hexrow{
      font-size: 94px;
      margin-top: -78px;
      letter-spacing: -13px;
    }
    .hexrowEven{
        margin-left: 36px;
    }
    .hexrowOdd{
    }
  </style>
  <script>
    const COLUMNS = 5
    const ROWS = 4

    const COLORCODE = {
      GESSO: "var(--GESSO)",
      CANAPA: "var(--CANAPA)",
      CACAO: "var(--CACAO)",
      CENERE: "var(--CENERE)",
      LAVAGNA: "var(--LAVAGNA)"
    }

    const COLORS = ["GESSO","CANAPA","CACAO","CENERE","LAVAGNA"]
    /***********************/
    function shuffle(array) {
      var currentIndex = array.length, temporaryValue, randomIndex;
      // While there remain elements to shuffle...
      while (0 !== currentIndex) {
        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;
        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
      }
      return array;
    }
    function queryString(key) {
        key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
        var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
        return match && decodeURIComponent(match[1].replace(/\+/g, " "));
    }
    /***********************/
    let colorsArray = COLORS.concat(COLORS).concat(COLORS).concat(COLORS)

    function init(){
      if (queryString("colorsArray")){
        const newColorsArray = queryString("colorsArray").split(",")
        if (newColorsArray.length == colorsArray.length) colorsArray = newColorsArray
      }

      let tileId = 0
      $("span[data-original='true']").each(function() {
        const generateElement = () => $("<span></span>")
                                      .attr("data-color",tileId)
                                      .text("⬢")
        for(let i=1; i<=COLUMNS; i++){
          $(this).append(generateElement())
          tileId++
        }
      })
      multiplyColumns()
      multiplyColumns()
      addTemplateListners()
      drawColors()
    }

    function multiplyColumns(){
      $(".hexrow").each(function() {
        const clonedSpan = $(this).children("span[data-original='true']").clone().attr("data-original",false)
        $(this).append(clonedSpan)
      })
    }
    function multiplyRows(){
      $("div.wrapper[data-original='true']").each(function() {
        const rows = $(this).clone().attr("data-original",false)
        rows.find("*[data-original='true']").attr("data-original",false)
        $("body").append(rows)
      })
    }
    function shuffleAndDraw(){
      shuffle(colorsArray)
      drawColors()
    }
    function drawColors(){
      $("*[data-color]").each(function() {
      const thisColor = $(this).attr("data-color")
      $(this).css("color",COLORCODE[colorsArray[thisColor]])
      $("#shareButton").attr("href",`https://wa.me/?text=https://abaroni.github.io?colorsArray=${colorsArray}`)
      })
    }

    let source = null
    function addTemplateListners(){
      $("*[data-template='true']").click(function() {
        if(!source){
          source = $(this)
          source.text("⬡")
        }else{
          const sourceDataColor = source.attr("data-color")
          const destinationDataColor = $(this).attr("data-color")
          const sourceColor = colorsArray[sourceDataColor]
          colorsArray[sourceDataColor] = colorsArray[destinationDataColor]
          colorsArray[destinationDataColor] = sourceColor
          source.text("⬢")
          source = null
          drawColors()
        }

      })
    }

  </script>
</head>
<body onload="init()">
  <div class="controls">
    <button type="button" class="btn btn-light" onclick="shuffleAndDraw()">Randomize</button>
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-light" data-toggle="modal" data-target="#changePatternModal">
      Change pattern
    </button>
    <a id="shareButton" class="btn btn-light">Share via Whatsapp</a>

  </div>
  <div data-original="true" class="wrapper">
    <div class="hexrow hexrowOdd"><span data-original="true"></span></div>
    <div class="hexrow hexrowEven"><span data-original="true"></span></div>
    <div class="hexrow hexrowOdd"><span data-original="true"></span></div>
    <div class="hexrow hexrowEven"><span data-original="true"></span></div>
  </div>


  <!-- Modal -->
  <div class="modal fade" id="changePatternModal" tabindex="-1" role="dialog" aria-labelledby="changePatternModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changePatternModalLabel">Click to switch</h5>
        </div>
        <div class="modal-body">
          <div data-original="false " class="wrapper">
            <div class="hexrow hexrowOdd"><span data-original="false"><span></span><span data-template="true" data-color="0" style="color: var(--GESSO);">⬢</span><span data-template="true" data-color="1" style="color: var(--CANAPA);">⬢</span><span data-template="true" data-color="2" style="color: var(--LAVAGNA);">⬢</span><span data-template="true" data-color="3" style="color: var(--CACAO);">⬢</span><span data-template="true" data-color="4" style="color: var(--CENERE);">⬢</span></span></div>
            <div class="hexrow hexrowEven"><span data-original="false"><span></span><span data-template="true" data-color="5" style="color: var(--CANAPA);">⬢</span><span data-template="true" data-color="6" style="color: var(--GESSO);">⬢</span><span data-template="true" data-color="7" style="color: var(--CENERE);">⬢</span><span data-template="true" data-color="8" style="color: var(--CACAO);">⬢</span><span data-template="true" data-color="9" style="color: var(--CENERE);">⬢</span></span></div>
            <div class="hexrow hexrowOdd"><span data-original="false"><span></span><span data-template="true" data-color="10" style="color: var(--CANAPA);">⬢</span><span data-template="true" data-color="11" style="color: var(--LAVAGNA);">⬢</span><span data-template="true" data-color="12" style="color: var(--CENERE);">⬢</span><span data-template="true" data-color="13" style="color: var(--GESSO);">⬢</span><span data-template="true" data-color="14" style="color: var(--GESSO);">⬢</span></span></div>
            <div class="hexrow hexrowEven"><span data-original="false"><span></span><span data-template="true" data-color="15" style="color: var(--CANAPA);">⬢</span><span data-template="true" data-color="16" style="color: var(--CACAO);">⬢</span><span data-template="true" data-color="17" style="color: var(--LAVAGNA);">⬢</span><span data-template="true" data-color="18" style="color: var(--LAVAGNA);">⬢</span><span data-template="true" data-color="19" style="color: var(--CACAO);">⬢</span></span></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
